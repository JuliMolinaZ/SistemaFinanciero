<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de M√≥dulos Problem√°ticos</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 15px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; color: #856404; }
        button { padding: 12px 24px; margin: 8px; background-color: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; }
        button:hover { background-color: #0056b3; }
        .module-test { margin: 10px 0; padding: 15px; border: 1px solid #ccc; border-radius: 4px; }
        .module-test.success { background-color: #d4edda; border-color: #c3e6cb; }
        .module-test.error { background-color: #f8d7da; border-color: #f5c6cb; }
        .module-test.loading { background-color: #fff3cd; border-color: #ffeaa7; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test de M√≥dulos Problem√°ticos</h1>
        
        <div class="test-section info">
            <h3>üìã Informaci√≥n del Test</h3>
            <p>Esta p√°gina prueba los m√≥dulos que estaban fallando desde "Cuentas por Pagar" hacia abajo.</p>
            <p><strong>Backend:</strong> http://localhost:8765</p>
            <p><strong>Frontend:</strong> http://localhost:2103</p>
            <p><strong>Timestamp:</strong> <span id="timestamp"></span></p>
        </div>

        <div class="test-section">
            <h3>üîß M√≥dulos a Probar</h3>
            <button onclick="testAllModules()" class="success">Probar Todos los M√≥dulos</button>
            <button onclick="testSpecificModule('cuentas-pagar')" class="warning">Cuentas por Pagar</button>
            <button onclick="testSpecificModule('cuentas-cobrar')" class="warning">Cuentas por Cobrar</button>
            <button onclick="testSpecificModule('contabilidad')" class="warning">Contabilidad</button>
            <button onclick="testSpecificModule('categorias')" class="warning">Categor√≠as</button>
            <button onclick="testSpecificModule('proveedores')" class="warning">Proveedores</button>
            <button onclick="testSpecificModule('projects')" class="warning">Proyectos</button>
            <button onclick="testSpecificModule('emitidas')" class="warning">Facturas Emitidas</button>
            <button onclick="testSpecificModule('cotizaciones')" class="warning">Cotizaciones</button>
            <button onclick="testSpecificModule('requisiciones')" class="warning">Requisiciones</button>
            <button onclick="testSpecificModule('recuperacion')" class="warning">Recuperaci√≥n</button>
            <button onclick="testSpecificModule('costos-fijos')" class="warning">Costos Fijos</button>
            <button onclick="testSpecificModule('phases')" class="warning">Fases</button>
            <button onclick="testSpecificModule('flowRecoveryV2')" class="warning">Flow Recovery V2</button>
        </div>

        <div class="test-section">
            <h3>üìä Resultados de las Pruebas</h3>
            <div id="test-results"></div>
        </div>

        <div class="test-section">
            <h3>üìù Log de Actividad</h3>
            <div id="activity-log"></div>
        </div>
    </div>

    <script>
        // Mostrar informaci√≥n actual
        document.getElementById('timestamp').textContent = new Date().toISOString();

        function addActivityLog(message, type = 'info') {
            const logDiv = document.getElementById('activity-log');
            const logElement = document.createElement('div');
            logElement.className = `module-test ${type}`;
            logElement.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(logElement);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function addTestResult(module, success, message) {
            const resultsDiv = document.getElementById('test-results');
            const resultElement = document.createElement('div');
            resultElement.className = `module-test ${success ? 'success' : 'error'}`;
            resultElement.innerHTML = `
                <strong>${module}:</strong> ${success ? '‚úÖ' : '‚ùå'} ${message}
            `;
            resultsDiv.appendChild(resultElement);
        }

        async function testModule(moduleName) {
            addActivityLog(`Probando m√≥dulo: ${moduleName}`, 'info');
            
            try {
                // Probar el endpoint del m√≥dulo
                const response = await fetch(`http://localhost:8765/api/${moduleName}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    timeout: 5000
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addTestResult(moduleName, true, `OK (${response.status}) - ${data.total || 'Sin datos'} registros`);
                    addActivityLog(`‚úÖ ${moduleName}: Exitoso`, 'success');
                    return true;
                } else {
                    addTestResult(moduleName, false, `Error ${response.status} - ${response.statusText}`);
                    addActivityLog(`‚ùå ${moduleName}: Error ${response.status}`, 'error');
                    return false;
                }
                
            } catch (error) {
                addTestResult(moduleName, false, `Error de conexi√≥n - ${error.message}`);
                addActivityLog(`‚ùå ${moduleName}: Error de conexi√≥n - ${error.message}`, 'error');
                return false;
            }
        }

        async function testSpecificModule(moduleName) {
            addActivityLog(`Iniciando prueba espec√≠fica para: ${moduleName}`, 'info');
            await testModule(moduleName);
        }

        async function testAllModules() {
            addActivityLog('Iniciando pruebas de todos los m√≥dulos', 'info');
            
            const modules = [
                'cuentas-pagar',
                'cuentas-cobrar', 
                'contabilidad',
                'categorias',
                'proveedores',
                'projects',  // Corregido: usar 'projects' en lugar de 'proyectos'
                'emitidas',
                'cotizaciones',
                'requisiciones',
                'recuperacion',
                'costos-fijos',
                'phases',    // Corregido: usar 'phases' en lugar de 'fases'
                'flowRecoveryV2'  // Corregido: usar 'flowRecoveryV2' en lugar de 'flow-recovery-v2'
            ];
            
            let successCount = 0;
            let totalCount = modules.length;
            
            for (const module of modules) {
                const success = await testModule(module);
                if (success) successCount++;
                
                // Peque√±a pausa entre pruebas
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            addActivityLog(`Pruebas completadas: ${successCount}/${totalCount} exitosas`, successCount === totalCount ? 'success' : 'warning');
        }

        // Ejecutar pruebas autom√°ticamente al cargar
        window.onload = function() {
            setTimeout(() => {
                addActivityLog('üöÄ Pruebas de m√≥dulos listas', 'info');
                addActivityLog('üí° Haz clic en los botones para probar m√≥dulos espec√≠ficos', 'info');
            }, 1000);
        };
    </script>
</body>
</html>
